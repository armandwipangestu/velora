@reference "../app/globals.css";

/* --- 1. Variables & Theme Configuration --- */

:root {
  --mdx-pre-bg: #eee;
  --mdx-inline-code-bg: #e3e3e3;
  --mdx-inline-code-text: #0f172a;
  
  --mdx-diff-add-bg: rgba(34, 197, 94, 0.2);
  --mdx-diff-remove-bg: rgba(239, 68, 68, 0.2);
  --mdx-diff-add-marker: rgb(34, 197, 94);
  --mdx-diff-remove-marker: rgb(239, 68, 68);
  --mdx-diff-add-border: theme('colors.green.500');
  --mdx-diff-remove-border: theme('colors.red.500');

  --mdx-highlight-line-bg: rgba(59, 130, 246, 0.15);
  --mdx-highlight-line-border: theme('colors.blue.400');
  
  --mdx-highlight-chars-bg: rgba(250, 204, 21, 0.35);
  
  --mdx-chars-v-bg: rgba(59, 130, 246, 0.3);
  --mdx-chars-v-border: rgba(59, 130, 246, 0.8);
  --mdx-chars-s-bg: rgba(34, 197, 94, 0.3);
  --mdx-chars-s-border: rgba(34, 197, 94, 0.8);
  --mdx-chars-i-bg: rgba(168, 85, 247, 0.3);
  --mdx-chars-i-border: rgba(168, 85, 247, 0.8);

  --mdx-error-bg: rgba(239, 68, 68, 0.15);
  --mdx-error-border: theme('colors.red.500');
  --mdx-warning-bg: rgba(245, 158, 11, 0.15);
  --mdx-warning-border: theme('colors.amber.500');
}

@media (prefers-color-scheme: dark) {
  html:not(.light) {
    --mdx-pre-bg: #171717;
    --mdx-inline-code-bg: #444;
    --mdx-inline-code-text: #f1f5f9;

    --mdx-diff-add-bg: rgba(34, 197, 94, 0.15);
    --mdx-diff-remove-bg: rgba(239, 68, 68, 0.15);

    --mdx-highlight-line-bg: rgba(200, 200, 255, 0.15);
    
    --mdx-highlight-chars-bg: rgba(110, 110, 140, 0.4);

    --mdx-error-bg: rgba(239, 68, 68, 0.2);
    --mdx-warning-bg: rgba(245, 158, 11, 0.2);
  }
}

html.dark {
  --mdx-pre-bg: #171717;
  --mdx-inline-code-bg: #444;
  --mdx-inline-code-text: #f1f5f9;

  --mdx-diff-add-bg: rgba(34, 197, 94, 0.15);
  --mdx-diff-remove-bg: rgba(239, 68, 68, 0.15);

  --mdx-highlight-line-bg: rgba(200, 200, 255, 0.15);
  
  --mdx-highlight-chars-bg: rgba(110, 110, 140, 0.4);

  --mdx-error-bg: rgba(239, 68, 68, 0.2);
  --mdx-warning-bg: rgba(245, 158, 11, 0.2);
}

/* --- 2. Base Typography & Fonts --- */

@font-face {
  font-family: "FiraCode Nerd Font";
  src: url('/fonts/FiraCodeNerdFontMono-Regular.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

[data-rehype-pretty-code-figure] pre {
  @apply px-0;
  background-color: var(--mdx-pre-bg);
  font-family: 'FiraCode Nerd Font', ui-monospace, monospace;
}

/* Ligature Management */
[data-rehype-pretty-code-figure] pre:not([data-ligatures="false"]) {
  font-variant-ligatures: discretionary-ligatures;
  font-feature-settings: "liga" 1, "calt" 1;
}

[data-rehype-pretty-code-figure] pre[data-ligatures="false"],
[data-rehype-pretty-code-figure] pre[data-font]:not([data-ligatures="true"]) {
  font-variant-ligatures: none !important;
  font-feature-settings: "liga" 0, "calt" 0 !important;
}

/* --- 3. Code & Inline Styling --- */

[data-rehype-pretty-code-figure] code {
  @apply text-sm leading-loose! md:text-base border-0 p-0;
}

/* Standard inline code (outside pre) */
.prose :where(code):not(:where(pre *, [data-rehype-pretty-code-figure] *)) {
  @apply rounded px-1.5 py-0.5 font-mono text-sm font-medium;
  background-color: var(--mdx-inline-code-bg);
  color: var(--mdx-inline-code-text);
}

/* Inline code with language highlighting */
[data-rehype-pretty-code-figure] > code {
  @apply rounded py-1.5 pt-[6px] pb-[4px];
  background-color: var(--mdx-pre-bg);
}

/* Dual theme support for code spans */
[data-rehype-pretty-code-figure] code[data-theme*=" "],
[data-rehype-pretty-code-figure] code[data-theme*=" "] span {
  color: var(--shiki-light);
  background-color: var(--mdx-pre-bg);
}

.dark [data-rehype-pretty-code-figure] code[data-theme*=" "],
.dark [data-rehype-pretty-code-figure] code[data-theme*=" "] span {
  color: var(--shiki-dark);
}

@media (prefers-color-scheme: dark) {
  html:not(.light) [data-rehype-pretty-code-figure] code[data-theme*=" "],
  html:not(.light) [data-rehype-pretty-code-figure] code[data-theme*=" "] span {
    color: var(--shiki-dark);
  }
}

/* Remove backticks */
[data-rehype-pretty-code-figure] > code::before,
[data-rehype-pretty-code-figure] > code::after,
.prose :where(code):not(:where([class~="not-prose"], [class~="not-prose"] *))::before,
.prose :where(code):not(:where([class~="not-prose"], [class~="not-prose"] *))::after {
  content: none !important;
}

/* --- 4. Line-level Features --- */

[data-rehype-pretty-code-figure] [data-line] {
  @apply border-l-2 border-l-transparent px-3;
}

/* Line Numbers */
[data-rehype-pretty-code-figure] code[data-line-numbers] {
  counter-reset: line;
}

[data-rehype-pretty-code-figure] code[data-line-numbers] > [data-line]::before {
  counter-increment: line;
  content: counter(line);
  @apply mr-4 inline-block w-4 text-right text-gray-500;
}

/* --- 5. Highlighting (Lines & Chars) --- */

/* Line Highlight */
[data-rehype-pretty-code-figure] [data-highlighted-line] {
  background: var(--mdx-highlight-line-bg) !important;
  border-left-color: var(--mdx-highlight-line-border);
}

[data-rehype-pretty-code-figure] [data-highlighted-line] span {
  background-color: transparent !important;
}

/* Error & Warning Highlights */
[data-rehype-pretty-code-figure] [data-line].highlighted.error {
  background-color: var(--mdx-error-bg) !important;
  border-left-color: var(--mdx-error-border);
}

[data-rehype-pretty-code-figure] [data-line].highlighted.warning {
  background-color: var(--mdx-warning-bg) !important;
  border-left-color: var(--mdx-warning-border);
}

[data-rehype-pretty-code-figure] [data-line].highlighted.error span,
[data-rehype-pretty-code-figure] [data-line].highlighted.warning span {
  background-color: transparent !important;
}

/* Character Highlight */
[data-rehype-pretty-code-figure] [data-highlighted-chars] {
  @apply rounded px-2 py-1;
  background-color: var(--mdx-highlight-chars-bg) !important;
  box-shadow: 0 0 0 0 var(--mdx-highlight-chars-bg);
}

[data-rehype-pretty-code-figure] [data-highlighted-chars] span {
  background-color: transparent !important;
}

/* Character IDs (#v, #s, #i) */
[data-rehype-pretty-code-figure] [data-chars-id] {
  @apply border-b-2 p-1 shadow-none;
}

[data-rehype-pretty-code-figure] [data-chars-id="v"] {
  background-color: var(--mdx-chars-v-bg) !important;
  border-bottom-color: var(--mdx-chars-v-border);
}

[data-rehype-pretty-code-figure] [data-chars-id="s"] {
  background-color: var(--mdx-chars-s-bg) !important;
  border-bottom-color: var(--mdx-chars-s-border);
}

[data-rehype-pretty-code-figure] [data-chars-id="i"] {
  background-color: var(--mdx-chars-i-bg) !important;
  border-bottom-color: var(--mdx-chars-i-border);
}

[data-rehype-pretty-code-figure] [data-chars-id] span {
  background-color: transparent !important;
}

/* --- 6. Notations (Diff, Focus, Error/Warning) --- */

/* Diff Notation */
[data-rehype-pretty-code-figure] pre [data-line].diff {
  @apply flex w-full transition-colors duration-200;
  display: flex !important;
  padding-left: 0;
}

[data-rehype-pretty-code-figure] pre [data-line].diff::before {
  content: "";
  @apply w-5 shrink-0 flex items-center justify-center mr-2;
}

[data-rehype-pretty-code-figure] pre [data-line].diff.add {
  background-color: var(--mdx-diff-add-bg);
  border-left-color: var(--mdx-diff-add-border);
}

[data-rehype-pretty-code-figure] pre [data-line].diff.add::before {
  content: "+";
  @apply text-green-500 font-bold;
}

[data-rehype-pretty-code-figure] pre [data-line].diff.remove {
  background-color: var(--mdx-diff-remove-bg);
  border-left-color: var(--mdx-diff-remove-border);
}

[data-rehype-pretty-code-figure] pre [data-line].diff.remove::before {
  content: "-";
  @apply text-red-500 font-bold;
}

[data-rehype-pretty-code-figure] [data-line].diff span {
  background-color: transparent !important;
}

/* Focus Notation */
[data-rehype-pretty-code-figure] pre.has-focused [data-line] {
  @apply transition-all duration-300;
  filter: blur(1.5px);
  opacity: 0.4;
}

[data-rehype-pretty-code-figure] pre.has-focused [data-line].focused {
  filter: blur(0);
  opacity: 1;
}

[data-rehype-pretty-code-figure] pre.has-focused:hover [data-line] {
  filter: blur(0);
  opacity: 1;
}

[data-rehype-pretty-code-figure] [data-line].focused span {
  background-color: transparent !important;
}

/* --- 7. Utilities --- */

.subheading-anchor {
  @apply no-underline hover:underline;
}

/* Code Group Styles */
.code-group {
  @apply my-6 overflow-hidden rounded-lg border bg-background;
}

.code-group .code-group-tabs {
  @apply flex items-center gap-1 overflow-x-auto py-1;
}

.code-group .code-group-tab {
  @apply flex items-center gap-2 rounded-md px-3 py-1.5 text-xs font-medium transition-all whitespace-nowrap;
}

.code-group .code-group-tab[data-active="true"] {
  @apply bg-muted/80 text-foreground shadow-sm;
}

.code-group .code-group-tab[data-active="false"] {
  @apply text-muted-foreground hover:bg-muted/50 hover:text-foreground;
}

/* Ensure figure inside code group doesn't have redundant styles */
.code-group .code-block-wrapper [data-rehype-pretty-code-figure] {
  @apply my-0 border-0 rounded-none;
}

.code-group .code-block-wrapper [data-rehype-pretty-code-figure] pre {
  @apply rounded-none border-0;
}


/* Utilities */
.scrollbar-hide {
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.scrollbar-hide::-webkit-scrollbar {
  display: none; /* Chrome, Safari and Opera */
}